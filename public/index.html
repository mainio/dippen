<!DOCTYPE html>
<html lang="en">
<head>
  <title>Dippen - Test page</title>

  <link href="/assets/quill.snow.css" rel="stylesheet">
<style>
html {
  font-family: sans-serif;
  font-size: 16px;
}

#wrapper {
  max-width: 1040px;
  margin: 0 auto;
}

.content h1 {
  text-align: center;
}

.ql-editor p {
  margin-bottom: 1rem;
}

.button {
  display: inline-block;
  background-color: #334577;
  border: 1px solid #334577;
  color: #fff;
  border-radius: 4px;
  padding: 10px 20px;
  font-size: 1rem;
}

a.button {
  color: #fff;
  text-decoration: none;
  cursor: pointer;
}

.button.hollow {
  background-color: transparent;
  color: #334577;
}

a.button.hollow {
  color: #334577;
}

.button.small {
  padding: 5px 10px;
  font-size: 0.8rem;
}

.button.large {
  padding: 15px 30px;
  font-size: 1.3rem;
}

.ql-snow .ql-editor a.button {
  text-decoration: none;
}
</style>
</head>
<body>
  <div id="wrapper">
    <div class="content">
      <h1>Dippen - Test page</h1>
    </div>
    <div id="editor">
      <h2>Welcome to Dippen!</h2>
      <p>This is some content.<br>This is content after a soft break.</p>
      <p>Here is some text with <a href="https://www.decidim.org" rel="noopener noreferrer" target="_blank">a link</a>.</p>
      <p><img src="/images/600x400.png" alt="This is an image"></p>
    </div>
  </div>

<script type="module">
import Quill, { dynamicToolbarItems, createServerUploader } from "./assets/dippen.js";

document.addEventListener("DOMContentLoaded", () => {
  const outerContainer = document.getElementById("editor");
  const container = document.createElement("div");
  container.innerHTML = outerContainer.innerHTML;
  outerContainer.innerHTML = '';
  outerContainer.append(container);

  const quillFormats = [
    "bold",
    "italic",
    "link",
    "underline",
    "header",
    "list",
    "break",
    "soft-break",
    "code",
    "blockquote",
    "indent",
    "image",
    "video",
  ];
  const quillToolbar = [
    [{ header: [2, 3, 4, 5, 6, false] }],
    ["bold", "italic", "underline", "soft-break"],
    [{ list: "ordered" }, { list: "bullet" }],
    ["link", "clean"],
    ["code", "blockquote"],
    [{ indent: "-1" }, { indent: "+1" }],
    ["video"],
    ["image"]
  ];

  const imageUploader = createServerUploader('/upload-image');

  const modules = {
    toolbar: {
      container: quillToolbar,
    },
    dynamicToolbar: {
      items: dynamicToolbarItems({
        target: {
          blot: "link",
          options: {
            "Link": "",
            "New tab": "_blank"
          }
        },
        style: {
          blot: "link",
          attribute: "class",
          options: {
            "Default": "",
            "Small button": "button primary small",
            "Small button (hollow)": "button primary hollow small",
            "Standard button": "button primary",
            "Standard button (hollow)": "button primary hollow",
            "Large button": "button primary large",
            "Large button (hollow)": "button primary hollow large"
          }
        }
      })
    },
    imageResize: { modules: ["Resize", "DisplaySize", "Keyboard"] },
    imageAlt: true,
    uploader: {
      async uploadHandler(file) {
        const response = await imageUploader(file);
        return response.url;
      },
    }
  };

  const quill = new Quill(container, {
    modules: modules,
    formats: quillFormats,
    theme: "snow"
  });

  window.editor = quill;
});
</script>
</body>
</html>
